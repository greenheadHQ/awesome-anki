# Security note: agenix provides at-rest encryption (secrets safe in git).
# Runtime: decrypted values are in env vars, same exposure as .env approach.
use flake

# ===== 로컬 설정 (비밀 아님) =====
export ANKI_CONNECT_URL=http://localhost:8765
export ANKI_CONNECT_VERSION=6
export TARGET_DECK='[책] 이것이 취업을 위한 컴퓨터 과학이다'
export ANKI_SPLITTER_PRIVACY_MASK_SENSITIVE=true
export ANKI_SPLITTER_PRIVACY_MODE=balanced
export ANKI_SPLITTER_PRIVACY_EMBEDDING_MAX_CHARS=2000
export ANKI_SPLITTER_PRIVACY_SPLIT_MAX_CHARS=6000
export ANKI_SPLITTER_PRIVACY_VALIDATION_MAX_CHARS=4000

# ===== 시크릿 (agenix 암호화) =====
_try_secret() {
  local var_name="$1" secret_file="$2" val
  if [ -f "$secret_file" ]; then
    if val=$(cd secrets && agenix -d "${secret_file##*/}" 2>/dev/null) && [ -n "$val" ]; then
      export "$var_name=$val"
      log_status "$var_name: loaded from agenix"
    else
      log_error "$var_name: agenix decrypt failed. Run 'cd secrets && agenix -d ${secret_file##*/}' to diagnose."
    fi
  else
    log_status "$var_name: no secret file (skipped)"
  fi
}
_try_secret GEMINI_API_KEY secrets/gemini-api-key.age
_try_secret OPENAI_API_KEY secrets/openai-api-key.age
_try_secret ANKI_SPLITTER_API_KEY secrets/anki-splitter-api-key.age
unset -f _try_secret
